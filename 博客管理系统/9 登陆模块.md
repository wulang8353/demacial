## 登陆模块

**body-parser 中间件，专门处理http请求的数据**


https://github.com/expressjs/body-parser

* 通过模型类Model操作数据库，调用返回的构造函数

```
// api.js

/*
 * 登录
 * */
router.post('/user/login', function(req, res) {
    var username = req.body.username;
    var password = req.body.password;

    if ( username == '' || password == '' ) {
        responseData.code = 1;
        responseData.message = '用户名和密码不能为空';
        res.json(responseData);
        return;
    }

    //查询数据库中相同用户名和密码的记录是否存在，如果存在则登录成功
    User.findOne({
        username: username,
        password: password
    }).then(function(userInfo) {   // 返回值是一个promise对象

        if (!userInfo) {
            responseData.code = 2;
            responseData.message = '用户名或密码错误';
            res.json(responseData);
            return;
        }
        //用户名和密码是正确的
        responseData.message = '登录成功';
        responseData.userInfo = {
            _id: userInfo._id,
            username: userInfo.username
        };
        // 设置存储位置的名字
        req.cookies.set('userInfo', JSON.stringify({ // 发送一个cookies给浏览器保存起来
            _id: userInfo._id,                       // 以后再访问的时候都会以头信息的方式发送给服务端
            username: userInfo.username
        }));
        res.json(responseData);
        return;
    });

});

/*
 * 退出
 * */
router.get('/user/logout', function(req, res) {
    req.cookies.set('userInfo', null);  // 清除cookies
    res.json(responseData);
});

```

* 将返回的提示信息显示在页面中，在index.js中修改

```
// index.js
...

//注册
$registerBox.find('button').on('click', function () {
    $.ajax({
        type: 'post',
        url: '/api/user/register', 
        data: {
            username: $registerBox.find('[name="username"]').val(),
            password: $registerBox.find('[name="password"]').val(),
            repassword:  $registerBox.find('[name="repassword"]').val()
        },
        dataType: 'json',
        success: function (result) {

            $registerBox.find('.colWarning').html(result.message);
            // 将返回的提示信息显示在页面中

            if (!result.code) {
                // code=0代表注册成功
                setTimeout(function() {
                    $loginBox.show();
                    $registerBox.hide();
                }, 1000);
            }

        }
    });
});
```






