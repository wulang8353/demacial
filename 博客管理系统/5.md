## 数据库连接

1 首先安装mongoDB,例如我是安装在D盘
![](/博客管理系统/img/数据库连接1.jpg)

2 启动数据库，在命令行中进入到D:\mongodb\bin，然后在--dbpath中输入你项目文件的路径，这一步的作用是为了在项目文件中设置存放数据的路径。我存在项目的路径：C:\Users\Administrator\Desktop\Blog
在命令行中输入 **mongod --dbpath=C:\Users\Administrator\Desktop\Blog --port=27010**

![](/博客管理系统/img/数据库连接3.jpg)

![](/博客管理系统/img/数据库连接2.jpg)


3 使用[Robomong](https://robomongo.org/download)图形界面用来操作数据库

![](/博客管理系统/img/数据库连接5.jpg)

![](/博客管理系统/img/数据库连接6.jpg)

![](/博客管理系统/img/数据库连接7.jpg)


4 本地项目连接数据库mongoose.connect('连接的地址',callback)运行app.js

![](/博客管理系统/img/数据库连接4.jpg)


* 引入依赖  [mongoose官方文档](http://www.nodeclass.com/api/mongoose.html#guide)

```
var mongoose = require('mongoose');     // 加载数据库模块

// 监听http请求，连接数据库
mongoose.connect('mongodb://localhost:27017/blog', function(err) {
    if (err) {
        console.log("数据库连接失败");
    } else {
        console.log("数据库连接成功！");
        app.listen("8081");
    }
});
```

* 使用Schema定义用户user的表结构 - 定义数据

```
var mongoose = require('mongoose');

//用户的表结构，通过构造一个对象得到一个表，并暴露出去
module.exports = new mongoose.Schema({

    //用户名
    username: String,
    //密码
    password: String,
});

```

* 定义用户user的模型类 - 操作数据

```
//  通过模型来对数据库中的表进行增删改查

var mongoose = require('mongoose');
var usersSchema = require('../schemas/users');

module.exports = mongoose.model('User', usersSchema);
```

* 目标代码

```
// app.js
var express = require('express');
var swig = require('swig');
var mongoose = require('mongoose');     // 加载数据库模块
var app = express();

app.use( '/public', express.static( __dirname + '/public') );

app.engine('html', swig.renderFile);
app.set('views', './views');
app.set('view engine', 'html');
swig.setDefaults({cache: false});

app.use('/admin', require('./routers/admin'));
app.use('/api', require('./routers/api'));
app.use('/', require('./routers/main'));


// 监听http请求，连接数据库
mongoose.connect('mongodb://localhost:27010/Connection27018', function(err) {
    if (err) {
        console.log("数据库连接失败");
    } else {
        console.log("数据库连接成功！");
        app.listen("8081");
    }
});




```



